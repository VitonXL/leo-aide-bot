{% extends "base.html" %}

{% block title %}–õ–µ–æ ‚Äî –§–∏–Ω–∞–Ω—Å—ã{% endblock %}

{% block styles %}
<style>
/* === –ï–î–ò–ù–ê–Ø –î–ò–ó–ê–ô–ù-–°–ò–°–¢–ï–ú–ê === */
:root {
  --bg: transparent;
  --card-bg: rgba(255, 255, 255, 0.95);
  --text: #212121;
  --text-secondary: #757575;
  --border: rgba(178, 255, 89, 0.2);
  --accent: #4CAF50;
  --accent-light: #B2FF59;
  --gold: linear-gradient(-45deg, #DAA520, #FFD700, #F4C430, #C5B358, #DAA520);
  --gold-soft: linear-gradient(-45deg, #D4A017, #E6C229, #F4C430, #D4A017);
  --radius-sm: 8px;
  --radius-md: 16px;
  --radius-lg: 24px;
  --shadow: 0 6px 20px rgba(76, 175, 80, 0.08);
  --shadow-hover: 0 12px 28px rgba(76, 175, 80, 0.16), 0 16px 40px rgba(0, 0, 0, 0.12);
  --transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

/* === –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê === */
[data-theme="dark"] {
  --bg: transparent;
  --card-bg: rgba(30, 30, 30, 0.95);
  --text: #ffffff;
  --text-secondary: #b0b0b0;
  --border: rgba(178, 255, 89, 0.1);
}

/* === –ì–õ–ê–í–ù–´–ô –§–û–ù === */
body, html {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Inter', sans-serif;
  color: var(--text);
  background: linear-gradient(135deg, #f0fff0, #d9f7d9, #e6ffeb);
  background-size: 400% 400%;
  animation: gradient-shift 15s ease infinite;
  min-height: 100vh;
  overflow-x: hidden;
}

[data-theme="dark"] body {
  background: linear-gradient(135deg, #0a1e0a, #0c240c, #0d2a0d);
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* === –ö–û–ù–¢–ï–ô–ù–ï–† === */
.container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

/* === –ó–ê–ì–û–õ–û–í–û–ö === */
.finance-header {
  text-align: center;
  margin: 40px 0 30px;
}

.finance-header h1 {
  font-size: 28px;
  font-weight: 700;
  color: var(--accent);
  margin: 0 0 8px 0;
}

.finance-header p {
  color: var(--text-secondary);
  font-size: 15px;
}

/* === –ë–ê–õ–ê–ù–° === */
.balance-card {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 28px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  text-align: center;
  margin-bottom: 30px;
  position: relative;
  overflow: hidden;
}

.balance-card::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 6px;
  background: var(--gold-soft);
  animation: shimmer-gold 6s ease-in-out infinite;
}

.balance-value {
  font-size: 36px;
  font-weight: 700;
  color: var(--accent);
  margin: 16px 0;
}

.balance-label {
  color: var(--text-secondary);
  font-size: 16px;
}

/* === –ö–ê–†–¢–´ === */
.card {
  background: var(--card-bg);
  border-radius: var(--radius-md);
  padding: 20px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  margin-bottom: 20px;
  transition: transform var(--transition);
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-hover);
}

.card h3 {
  margin: 0 0 16px 0;
  font-size: 18px;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: 8px;
}

/* === –§–û–†–ú–´ === */
.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
  color: var(--text-secondary);
  font-weight: 500;
}

.form-group input,
.form-group select,
.form-group button {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 15px;
  background: var(--card-bg);
  color: var(--text);
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--accent);
}

/* === –ö–ù–û–ü–ö–ò === */
.btn {
  padding: 12px 24px;
  border: none;
  border-radius: var(--radius-sm);
  color: white;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: #4CAF50;
}

.btn-primary {
  background: var(--gold);
  background-size: 200% 200%;
  animation: gradient-shift-gold 3s ease infinite;
  color: white;
}

.btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(76, 175, 80, 0.25);
}

.btn:active {
  transform: translateY(-1px);
}

/* === –°–ü–ò–°–ö–ò === */
.item-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 300px;
  overflow-y: auto;
  padding-right: 8px;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: rgba(76, 175, 80, 0.06);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  font-size: 15px;
}

.item .amount {
  font-weight: 600;
  color: var(--text);
}

.item.income {
  border-left: 4px solid #4CAF50;
}

.item.expense {
  border-left: 4px solid #f44336;
}

/* === –ê–ù–ò–ú–ê–¶–ò–ò === */
@keyframes gradient-shift-gold {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes shimmer-gold {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* === –ê–î–ê–ü–¢–ò–í === */
@media (max-width: 768px) {
  .balance-value {
    font-size: 32px;
  }
  .btn {
    font-size: 14px;
  }
}
</style>
{{ super() }}
{% endblock %}

{% block content %}
  <div class="container">
    <div class="finance-header">
      <h1>üí∞ –§–∏–Ω–∞–Ω—Å—ã</h1>
      <p>–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Ö–æ–¥–æ–≤, —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂</p>
    </div>

    <!-- –ë–∞–ª–∞–Ω—Å -->
    <div class="balance-card">
      <div class="balance-label">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</div>
      <div class="balance-value" id="balance">0 ‚ÇΩ</div>
      <div class="balance-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="last-update">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span></div>
    </div>

    <!-- –î–æ—Ö–æ–¥—ã -->
    <div class="card">
      <h3><span class="material-icons">trending_up</span> –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</h3>
      <div class="form-group">
        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
        <input type="number" id="income-amount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5000">
      </div>
      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="income-category">
          <option value="–ó–∞—Ä–ø–ª–∞—Ç–∞">–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
          <option value="–§—Ä–∏–ª–∞–Ω—Å">–§—Ä–∏–ª–∞–Ω—Å</option>
          <option value="–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</option>
          <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="addIncome()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥</button>
    </div>

    <!-- –†–∞—Å—Ö–æ–¥—ã -->
    <div class="card">
      <h3><span class="material-icons">trending_down</span> –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h3>
      <div class="form-group">
        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
        <input type="number" id="expense-amount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1200">
      </div>
      <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="expense-category">
          <option value="–ï–¥–∞">–ï–¥–∞</option>
          <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
          <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
          <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
        </select>
      </div>
      <button class="btn" onclick="addExpense()">‚ûñ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
    </div>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div class="card">
      <h3><span class="material-icons">category</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
      <div class="form-group">
        <label>–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <input type="text" id="new-category" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: YouTube">
      </div>
      <div class="form-group">
        <label>–¢–∏–ø</label>
        <select id="category-type">
          <option value="income">–î–æ—Ö–æ–¥</option>
          <option value="expense">–†–∞—Å—Ö–æ–¥</option>
        </select>
      </div>
      <button class="btn" onclick="addCustomCategory()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
    </div>

    <!-- –ü—Ä–æ–¥–∞–∂–∏ -->
    <div class="card">
      <h3><span class="material-icons">sell</span> –£—á—ë—Ç –ø—Ä–æ–¥–∞–∂</h3>
      <div class="form-group">
        <label>–ß—Ç–æ –ø—Ä–æ–¥–∞–ª?</label>
        <input type="text" id="sold-item" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É—Ä—Å –ø–æ Python">
      </div>
      <div class="form-group">
        <label>–°—É–º–º–∞ (‚ÇΩ)</label>
        <input type="number" id="sold-amount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10000">
      </div>
      <div class="form-group">
        <label>–î–∞—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏</label>
        <input type="date" id="sold-date" value="{{ today }}">
      </div>
      <button class="btn btn-primary" onclick="recordSale()">üì¶ –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É</button>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è -->
    <div class="card">
      <h3><span class="material-icons">history</span> –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
      <div class="item-list" id="history">
        <div class="item income">
          <div>–ó–∞—Ä–ø–ª–∞—Ç–∞</div>
          <div class="amount">+5000 ‚ÇΩ</div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    let balance = 0;
    const history = [];
    const categories = {
      income: ["–ó–∞—Ä–ø–ª–∞—Ç–∞", "–§—Ä–∏–ª–∞–Ω—Å", "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–î—Ä—É–≥–æ–µ"],
      expense: ["–ï–¥–∞", "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", "–î—Ä—É–≥–æ–µ"]
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    function updateUI() {
      document.getElementById('balance').textContent = balance + ' ‚ÇΩ';
      document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
      
      const historyEl = document.getElementById('history');
      historyEl.innerHTML = '';
      [...history].reverse().forEach(item => {
        const div = document.createElement('div');
        div.className = `item ${item.type}`;
        div.innerHTML = `
          <div>${item.title}</div>
          <div class="amount">${item.type === 'income' ? '+' : '-'}${item.amount} ‚ÇΩ</div>
        `;
        historyEl.appendChild(div);
      });
    }

    function addIncome() {
      const amount = parseFloat(document.getElementById('income-amount').value);
      const category = document.getElementById('income-category').value;
      if (isNaN(amount) || amount <= 0) return Toast.error('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
      
      balance += amount;
      history.push({ type: 'income', title: category, amount });
      document.getElementById('income-amount').value = '';
      updateUI();
      Toast.success(`+${amount} ‚ÇΩ –¥–æ–±–∞–≤–ª–µ–Ω–æ`);
    }

    function addExpense() {
      const amount = parseFloat(document.getElementById('expense-amount').value);
      const category = document.getElementById('expense-category').value;
      if (isNaN(amount) || amount <= 0) return Toast.error('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
      if (amount > balance) return Toast.error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
      
      balance -= amount;
      history.push({ type: 'expense', title: category, amount });
      document.getElementById('expense-amount').value = '';
      updateUI();
      Toast.info(`-${amount} ‚ÇΩ —Å–ø–∏—Å–∞–Ω–æ`);
    }

    function addCustomCategory() {
      const name = document.getElementById('new-category').value.trim();
      const type = document.getElementById('category-type').value;
      if (!name) return Toast.error('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
      if (categories[type].includes(name)) return Toast.info('–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ –µ—Å—Ç—å');
      
      categories[type].push(name);
      updateCategorySelects();
      document.getElementById('new-category').value = '';
      Toast.success(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
    }

    function updateCategorySelects() {
      const incSelect = document.getElementById('income-category');
      const expSelect = document.getElementById('expense-category');
      
      // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º
      [incSelect, expSelect].forEach((sel, i) => {
        const type = i === 0 ? 'income' : 'expense';
        sel.innerHTML = '';
        categories[type].forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          sel.appendChild(opt);
        });
      });
    }

    function recordSale() {
      const item = document.getElementById('sold-item').value.trim();
      const amount = parseFloat(document.getElementById('sold-amount').value);
      const date = document.getElementById('sold-date').value;
      if (!item || isNaN(amount) || amount <= 0) return Toast.error('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
      
      balance += amount;
      history.push({ 
        type: 'income', 
        title: `–ü—Ä–æ–¥–∞–∂–∞: ${item}`, 
        amount 
      });
      updateUI();
      Toast.success(`üì¶ –ü—Ä–æ–¥–∞–∂–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞: +${amount} ‚ÇΩ`);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      updateCategorySelects();
      updateUI();
      Toast.info('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–æ—Ç–æ–≤');
    });

    // –ü–µ—Ä–µ–¥–∞—ë–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –≤ —à–∞–±–ª–æ–Ω
    document.getElementById('sold-date').value = new Date().toISOString().split('T')[0];
  </script>
{% endblock %}