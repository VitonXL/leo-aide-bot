<!DOCTYPE html>
<html lang="ru" class="gradient-bg" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –õ–µ–æ</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/main.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    
    <!-- –•–µ–¥–µ—Ä -->
    <header style="display: flex; align-items: center; gap: 16px; margin-bottom: 30px;">
      <button class="btn" onclick="goBack()" style="padding: 8px 16px; font-size: 14px;">‚Üê –ù–∞–∑–∞–¥</button>
      <h1 style="margin: 0; color: var(--accent);">üëÆ‚Äç‚ôÇÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
      <div style="margin-left: auto; background: #8E24AA; color: white; padding: 6px 12px; border-radius: 12px; font-size: 14px;">üëë –ê–¥–º–∏–Ω</div>
    </header>

    <!-- –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <div style="margin-bottom: 20px; text-align: right;">
      <label style="color: var(--text-secondary);"><strong>–†–µ–∂–∏–º:</strong></label>
      <select id="view-mode" onchange="changeViewMode(this.value)" style="padding: 8px 12px; border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--card-bg); color: var(--text);">
        <option value="cards">–ö–∞—Ä—Ç–æ—á–∫–∏</option>
        <option value="table">–¢–∞–±–ª–∏—Ü–∞</option>
        <option value="chart">–ì—Ä–∞—Ñ–∏–∫</option>
        <option value="bars">–°—Ç–æ–ª–±—Ü—ã</option>
      </select>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div id="stats-container" class="card" style="margin-bottom: 30px;">
      <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
      <p><strong>–í—Å–µ–≥–æ:</strong> <span id="total-users">‚Äì</span></p>
      <p><strong>–ü—Ä–µ–º–∏—É–º:</strong> <span id="premium-users">‚Äì</span></p>
      <p><strong>–°–µ–≥–æ–¥–Ω—è:</strong> <span id="active-today">‚Äì</span></p>
      <p><strong>–†–µ—Ñ–µ—Ä–∞–ª–æ–≤:</strong> <span id="referrals-count">‚Äì</span></p>
    </div>

    <!-- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div class="card" style="margin-bottom: 30px;">
      <h3>üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
      <div style="display: flex; gap: 10px; margin: 15px 0;">
        <input type="text" id="search-user" placeholder="ID –∏–ª–∏ @username" style="flex: 1; padding: 12px; border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--card-bg); color: var(--text);">
        <button class="btn" onclick="searchUser()">–ü–æ–∏—Å–∫</button>
      </div>
      <div id="user-actions" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
        <p style="color: var(--text-secondary);"><strong>–ù–∞–π–¥–µ–Ω:</strong> <span id="found-user"></span></p>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button class="btn" style="background: #4CAF50;" onclick="grantPremium()">‚úÖ –í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º</button>
          <button class="btn" style="background: #FF9800;" onclick="revokePremium()">üö´ –°–Ω—è—Ç—å</button>
          <button class="btn" style="background: #F44336;" onclick="blockUser()">‚õî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ -->
    <div class="card" style="margin-bottom: 30px;">
      <h3>üìù –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤</h3>
      <div id="reviews-list" style="max-height: 300px; overflow-y: auto;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    </div>

    <!-- –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ -->
    <div class="card" style="margin-bottom: 30px;">
      <h3>üì¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
      <div id="support-list" style="max-height: 300px; overflow-y: auto;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...</p>
      </div>
    </div>

    <!-- –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ -->
    <div class="card" style="margin-bottom: 30px;">
      <h3>üìù –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤</h3>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
        <button class="btn" onclick="useTemplate('–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! ‚úÖ')" style="padding: 8px 12px; font-size: 14px;">–°–ø–∞—Å–∏–±–æ</button>
        <button class="btn" onclick="useTemplate('–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.')" style="padding: 8px 12px; font-size: 14px;">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ</button>
        <button class="btn" onclick="useTemplate('–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤–æ—à–ª–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç –∏ –æ–±–Ω–æ–≤–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.')" style="padding: 8px 12px; font-size: 14px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ</button>
        <button class="btn" onclick="useTemplate('–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: https://leo-aide.online/faq')" style="padding: 8px 12px; font-size: 14px;">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
        <button class="btn" onclick="useTemplate('–ú—ã –ø–æ–ª—É—á–∏–ª–∏ –≤–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –Ω–∏–º.')" style="padding: 8px 12px; font-size: 14px;">–û–±—Ä–∞–±–æ—Ç–∫–∞</button>
      </div>
    </div>

    <!-- –†–µ–∫–ª–∞–º–∞ -->
    <div class="card">
      <h3>üì¢ –†–µ–∫–ª–∞–º–∞</h3>
      <div id="ads-list" style="margin-top: 15px;">
        <p>üõ† –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
      </div>
    </div>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script>
    let statsData = {};
    let currentChart = null;

    document.addEventListener('DOMContentLoaded', async () => {
      console.log('‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
      await loadStats();
      await loadReviews();
      await loadSupportTickets();
      changeViewMode('cards');
    });

    async function loadStats() {
      try {
        const res = await fetch('/api/admin/stats');
        statsData = await res.json();
        renderStatsCards();
      } catch (e) {
        document.getElementById('stats-container').innerHTML = '<p class="text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', e);
      }
    }

    function changeViewMode(mode) {
      if (currentChart) {
        currentChart.destroy();
        currentChart = null;
      }

      if (mode === 'cards') renderStatsCards();
      else if (mode === 'table') renderStatsTable();
      else if (mode === 'chart') renderActivityChart();
      else if (mode === 'bars') renderCommandsChart();
    }

    function renderStatsCards() {
      document.getElementById('stats-container').innerHTML = `
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <div style="flex: 1; min-width: 200px; background: #1976D2; color: white; padding: 20px; border-radius: var(--radius-md); text-align: center;">
            <h4 style="margin: 0; font-size: 28px;">${statsData.total_users || 0}</h4>
            <p style="margin: 8px 0 0; opacity: 0.9;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
          </div>
          <div style="flex: 1; min-width: 200px; background: #388E3C; color: white; padding: 20px; border-radius: var(--radius-md); text-align: center;">
            <h4 style="margin: 0; font-size: 28px;">${statsData.premium_users || 0}</h4>
            <p style="margin: 8px 0 0; opacity: 0.9;">–ü—Ä–µ–º–∏—É–º</p>
          </div>
          <div style="flex: 1; min-width: 200px; background: #1976D2; color: white; padding: 20px; border-radius: var(--radius-md); text-align: center;">
            <h4 style="margin: 0; font-size: 28px;">${statsData.active_today || 0}</h4>
            <p style="margin: 8px 0 0; opacity: 0.9;">–ê–∫—Ç–∏–≤–Ω–æ —Å–µ–≥–æ–¥–Ω—è</p>
          </div>
          <div style="flex: 1; min-width: 200px; background: #FF8F00; color: white; padding: 20px; border-radius: var(--radius-md); text-align: center;">
            <h4 style="margin: 0; font-size: 28px;">${statsData.referrals_count || 0}</h4>
            <p style="margin: 8px 0 0; opacity: 0.9;">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</p>
          </div>
        </div>`;
    }

    function renderStatsTable() {
      document.getElementById('stats-container').innerHTML = `
        <table style="
          width: 100%;
          border-collapse: collapse;
          background: var(--card-bg);
          border-radius: var(--radius-md);
          overflow: hidden;
          box-shadow: var(--shadow);
          font-size: 14px;
        ">
          <thead>
            <tr style="
              background: var(--accent-light);
              color: var(--text);
              font-weight: 500;
              text-align: left;
            ">
              <th style="padding: 14px 20px; border-bottom: 2px solid var(--border);">–ú–µ—Ç—Ä–∏–∫–∞</th>
              <th style="padding: 14px 20px; border-bottom: 2px solid var(--border);">–ó–Ω–∞—á–µ–Ω–∏–µ</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background: var(--bg);">
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); color: var(--text-secondary);">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</td>
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); font-weight: 500; color: #1976D2;">${statsData.total_users || 0}</td>
            </tr>
            <tr style="background: var(--card-bg);">
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); color: var(--text-secondary);">–ü—Ä–µ–º–∏—É–º</td>
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); font-weight: 500; color: #388E3C;">${statsData.premium_users || 0}</td>
            </tr>
            <tr style="background: var(--bg);">
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); color: var(--text-secondary);">–ê–∫—Ç–∏–≤–Ω–æ —Å–µ–≥–æ–¥–Ω—è</td>
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); font-weight: 500; color: #1976D2;">${statsData.active_today || 0}</td>
            </tr>
            <tr style="background: var(--card-bg);">
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); color: var(--text-secondary);">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</td>
              <td style="padding: 14px 20px; border-bottom: 1px solid var(--border); font-weight: 500; color: #FF8F00;">${statsData.referrals_count || 0}</td>
            </tr>
          </tbody>
        </table>
      `;
    }

    function renderActivityChart() {
      if (currentChart) {
        currentChart.destroy();
        currentChart = null;
      }

      const container = document.getElementById('stats-container');
      container.innerHTML = '<div class="chart-wrapper"><canvas id="activityChart"></canvas></div>';

      requestAnimationFrame(() => {
        fetch('/api/admin/activity-by-day')
          .then(res => res.json())
          .then(data => {
            const ctx = document.getElementById('activityChart').getContext('2d');
            currentChart = new Chart(ctx, {
              type: 'line',
              data: {
                labels: data.dates,
                datasets: [{
                  label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º',
                  data: data.counts,
                  borderColor: '#4CAF50',
                  backgroundColor: 'rgba(76, 175, 80, 0.1)',
                  fill: true,
                  tension: 0.3
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 400 },
                plugins: { legend: { display: true } }
              }
            });
          })
          .catch(err => {
            container.innerHTML = '<p class="text-danger">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫</p>';
            console.error('‚ùå –û—à–∏–±–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞:', err);
          });
      });
    }

    function renderCommandsChart() {
      if (currentChart) {
        currentChart.destroy();
        currentChart = null;
      }

      const container = document.getElementById('stats-container');
      container.innerHTML = '<div class="chart-wrapper"><canvas id="commandsChart"></canvas></div>';

      requestAnimationFrame(() => {
        fetch('/api/admin/top-commands')
          .then(res => res.json())
          .then(data => {
            const ctx = document.getElementById('commandsChart').getContext('2d');
            currentChart = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: data.commands,
                datasets: [{
                  label: '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ',
                  data: data.counts,
                  backgroundColor: '#66BB6A'
                }]
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 400 },
                indexAxis: 'y',
                plugins: { legend: { display: true } }
              }
            });
          })
          .catch(err => {
            container.innerHTML = '<p class="text-danger">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∏–∞–≥—Ä–∞–º–º—É</p>';
            console.error('‚ùå –û—à–∏–±–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã:', err);
          });
      });
    }

    async function searchUser() {
      const q = document.getElementById('search-user').value.trim();
      if (!q) return;
      try {
        const res = await fetch(`/api/admin/user?query=${encodeURIComponent(q)}`);
        const user = await res.json();
        if (user) {
          document.getElementById('found-user').textContent = `@${user.username} (ID: ${user.id})`;
          document.getElementById('user-actions').style.display = 'block';
          window.user = user;
        } else {
          alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
      } catch (e) {
        alert('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
        console.error(e);
      }
    }

    async function grantPremium() {
      if (!window.user) return;
      if (!confirm(`–í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º @${window.user.username}?`)) return;
      try {
        await fetch('/api/admin/grant-premium', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: window.user.id })
        });
        alert('‚úÖ –ü—Ä–µ–º–∏—É–º –≤—ã–¥–∞–Ω –Ω–∞ 30 –¥–Ω–µ–π');
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏');
      }
    }

    async function revokePremium() {
      if (!window.user) return;
      if (!confirm(`–°–Ω—è—Ç—å –ø—Ä–µ–º–∏—É–º —É @${window.user.username}?`)) return;
      try {
        await fetch('/api/admin/revoke-premium', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: window.user.id })
        });
        alert('‚úÖ –ü—Ä–µ–º–∏—É–º —Å–Ω—è—Ç');
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–Ω—è—Ç–∏—è');
      }
    }

    async function blockUser() {
      if (!window.user) return;
      if (!confirm(`–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å @${window.user.username}?`)) return;
      try {
        await fetch('/api/admin/block-user', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: window.user.id })
        });
        alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏');
      }
    }

    async function loadReviews() {
      try {
        const res = await fetch('/api/admin/reviews');
        const reviews = await res.json();
        const container = document.getElementById('reviews-list');
        container.innerHTML = reviews.map(r => `
          <div style="padding: 12px; border-bottom: 1px solid var(--border);">
            <strong>${r.first_name} (@${r.username})</strong> <span style="color: #FFA000;">‚≠ê ${r.rating}</span>
            <p style="margin: 8px 0; color: var(--text);">${r.text}</p>
            <small style="color: var(--text-secondary);">${new Date(r.created_at).toLocaleString()}</small>
            <div style="margin-top: 8px; display: flex; gap: 8px;">
              <button class="btn" style="padding: 5px 10px; font-size: 12px;" onclick="approveReview(${r.id})">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
              <button class="btn" style="background: #F44336; padding: 5px 10px; font-size: 12px;" onclick="deleteReview(${r.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        document.getElementById('reviews-list').innerHTML = '<p class="text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤</p>';
        console.error(e);
      }
    }

    async function loadSupportTickets() {
      try {
        const res = await fetch('/api/admin/support-tickets');
        const tickets = await res.json();
        const container = document.getElementById('support-list');
        container.innerHTML = tickets.map(t => `
          <div style="padding: 12px; border-bottom: 1px solid var(--border);">
            <strong>@${t.username}</strong> (${t.first_name})
            <p style="margin: 8px 0; font-size: 14px; white-space: pre-wrap; color: var(--text);">${t.message}</p>
            <span style="
              font-size: 12px;
              padding: 3px 8px;
              border-radius: 10px;
              background: ${t.status === 'open' ? '#ffebee' : t.status === 'in_progress' ? '#fff8e1' : '#e8f5e8'};
              color: ${t.status === 'open' ? '#c62828' : t.status === 'in_progress' ? '#f57f17' : '#2e7d32'};
            ">
              ${t.status === 'open' ? 'üî¥ –û—Ç–∫—Ä—ã—Ç' : t.status === 'in_progress' ? 'üü° –í —Ä–∞–±–æ—Ç–µ' : 'üü¢ –ó–∞–∫—Ä—ã—Ç'}
            </span>
            <small style="color: var(--text-secondary);">${new Date(t.created_at).toLocaleString()}</small>
            <div style="margin-top: 8px;">
              <button class="btn" style="background: #2196F3; padding: 5px 10px; font-size: 12px;"
                  onclick="replyToTicket(${t.id}, ${t.user_id})">üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        document.getElementById('support-list').innerHTML = '<p class="text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>';
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∏–∫–µ—Ç–æ–≤:', e);
      }
    }

    async function replyToTicket(ticketId, userId) {
      const reply = prompt("–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:");
      if (!reply || !reply.trim()) return;

      try {
        const res = await fetch('/api/admin/reply-support', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ticket_id: ticketId, reply_text: reply.trim() })
        });

        if (res.ok) {
          const data = await res.json();
          alert(data.message || '‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
          await loadSupportTickets();
        } else {
          const text = await res.text();
          console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', text);
          alert(`‚ùå –û—à–∏–±–∫–∞: ${text.substring(0, 200)}`);
        }
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏.');
        console.error(e);
      }
    }

    async function approveReview(reviewId) {
      if (!confirm("–ü—Ä–∏–Ω—è—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤?")) return;
      try {
        await fetch('/api/admin/approve-review', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ review_id: reviewId })
        });
        alert('‚úÖ –û—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç');
        await loadReviews();
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞');
      }
    }

    async function deleteReview(reviewId) {
      if (!confirm("–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤?")) return;
      try {
        await fetch('/api/admin/delete-review', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ review_id: reviewId })
        });
        alert('üóë –û—Ç–∑—ã–≤ —É–¥–∞–ª—ë–Ω');
        await loadReviews();
      } catch (e) {
        alert('‚ùå –û—à–∏–±–∫–∞');
      }
    }

    function goBack() {
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.close();
      } else {
        window.location.href = "https://t.me/leo_aide_bot";
      }
    }

    function useTemplate(text) {
      // –ú–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–∑–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ replyToTicket
      console.log('–®–∞–±–ª–æ–Ω –≤—ã–±—Ä–∞–Ω:', text);
    }
  </script>
</body>
</html>