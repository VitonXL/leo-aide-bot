<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ–µ–æ –ü–æ–º–æ—â–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">

    <!-- üî¥ –í–°–¢–†–û–ï–ù–ù–´–ô CSS -->
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --accent: #4CAF50;
        --accent-light: #B2FF59;
        --bg-primary: #f8fbf8;
        --bg-secondary: #ffffff;
        --bg-hover: #e8f5e9;
        --bg-dark: #0d1117;
        --bg-dark-secondary: #121821;
        --bg-dark-hover: #161f2b;
        --text-primary: #212121;
        --text-secondary: #757575;
        --text-dark: #e0f7ff;
        --border-light: rgba(76, 175, 80, 0.12);
        --border-dark: rgba(178, 255, 89, 0.16);
        --gold: #DAA520;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
      }

      [data-theme="dark"] {
        --bg-primary: var(--bg-dark);
        --bg-secondary: var(--bg-dark-secondary);
        --bg-hover: var(--bg-dark-hover);
        --text-primary: var(--text-dark);
        --text-secondary: #88c0d0;
        --accent: #B2FF59;
      }

      body {
        font-family: 'Inter', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        padding: 0;
        margin: 0;
        line-height: 1.6;
        overflow-x: hidden;
      }

      /* === –®–ê–ü–ö–ê –ù–ê –í–°–Æ –®–ò–†–ò–ù–£ === */
      #combined-header {
        position: sticky !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1000 !important;
        background: rgba(255, 255, 255, 0.96) !important;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(220, 255, 240, 0.9)) !important;
        backdrop-filter: blur(12px) !important;
        -webkit-backdrop-filter: blur(12px) !important;
        border-bottom: 1px solid var(--border-light) !important;
        transition: transform 0.3s ease !important;
      }

      [data-theme="dark"] #combined-header {
        background: rgba(13, 17, 23, 0.96) !important;
        background: linear-gradient(145deg, rgba(13, 17, 23, 0.98), rgba(18, 24, 33, 0.9)) !important;
        border-color: var(--border-dark) !important;
      }

      #combined-header.hidden {
        transform: translateY(-100%) !important;
      }

      .app-icon-wrapper {
        width: 36px !important;
        height: 36px !important;
        border-radius: 12px !important;
        overflow: hidden !important;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1) !important;
      }

      .app-icon {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
      }

      #menu-btn,
      #theme-toggle {
        width: 40px !important;
        height: 40px !important;
        border-radius: 50% !important;
        background: transparent !important;
        border: none !important;
        color: var(--accent) !important;
        cursor: pointer !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }

      #theme-toggle {
        background: #ffffff !important;
        border: 1px solid var(--border-light) !important;
      }

      [data-theme="dark"] #theme-toggle {
        background: #121821 !important;
        border-color: var(--border-dark) !important;
        color: var(--accent-light) !important;
      }

      #menu-btn:hover,
      #theme-toggle:hover {
        background: var(--bg-hover) !important;
      }

      .page-title {
        flex: 1 !important;
        text-align: center !important;
        font-weight: 600 !important;
        font-size: 1.1em !important;
        color: var(--text-primary) !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        margin: 0 8px !important;
      }

      [data-theme="dark"] .page-title {
        color: var(--text-dark) !important;
      }

      .user-avatar {
        width: 36px !important;
        height: 36px !important;
        border-radius: 50% !important;
        border: 2px solid var(--accent) !important;
        object-fit: cover !important;
        box-shadow: 0 0 0 2px #ffffff !important;
      }

      [data-theme="dark"] .user-avatar {
        border-color: var(--accent-light) !important;
        box-shadow: 0 0 0 2px #0d1117 !important;
      }

      /* === –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò === */
      .btn-primary {
        background: var(--accent);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        box-shadow: 0 4px 14px rgba(76, 175, 80, 0.3);
        transition: var(--transition);
        margin-top: 12px;
        display: inline-block;
        text-align: center;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(76, 175, 80, 0.4);
      }

      .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-light);
        border-radius: 16px;
        padding: 24px;
        box-shadow: var(--shadow);
        margin-bottom: 24px;
      }

      [data-theme="dark"] .card {
        background: var(--bg-dark-secondary);
        border-color: var(--border-dark);
        color: var(--text-primary);
      }

      .main-content {
        margin-top: 60px;
        padding: 0 16px;
        min-height: calc(100vh - 60px);
      }

      #toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
        font-size: 14px;
        white-space: nowrap;
      }

      #toast.show {
        opacity: 1;
      }
    </style>
</head>
<body>
    <!-- –®–ê–ü–ö–ê –ù–ê –í–°–Æ –®–ò–†–ò–ù–£ –≠–ö–†–ê–ù–ê -->
    <header id="combined-header">
        <div style="display: flex !important; justify-content: space-between !important; align-items: center !important; width: 100% !important; padding: 0 16px !important; height: 60px !important; max-width: 100vw !important; margin: 0 auto !important; box-sizing: border-box !important;">
            
            <!-- –õ–ï–í–û -->
            <div style="display: flex !important; align-items: center !important; gap: 8px !important; flex-shrink: 0 !important;">
                <div class="app-icon-wrapper">
                    <img src="/static/favicon.ico" alt="–õ–µ–æ" class="app-icon">
                </div>
                <button class="btn-icon" id="menu-btn">
                    <span class="material-icons">menu</span>
                </button>
            </div>

            <!-- –¶–ï–ù–¢–† -->
            <div class="page-title">
                {{ page_title | default("–ì–ª–∞–≤–Ω–∞—è") }}
            </div>

            <!-- –ü–†–ê–í–û -->
            <div style="display: flex !important; align-items: center !important; gap: 8px !important; flex-shrink: 0 !important;">
                <button class="btn-icon" id="theme-toggle">
                    <span class="material-icons" id="theme-icon">dark_mode</span>
                </button>
                <img src="{{ user.get('avatar_url', '/static/img/avatar-placeholder.png') }}" alt="User" class="user-avatar">
            </div>

        </div>
    </header>

    <div class="main-content">
        {% block content %}{% endblock %}
    </div>

    <div id="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <!-- üî• –í–°–¢–†–û–ï–ù–ù–´–ô JS -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;

        const savedTheme = 
          document.cookie.match(/theme=([^;]+)/)?.[1] ||
          localStorage.getItem('theme') || 
          'light';

        html.setAttribute('data-theme', savedTheme);
        themeIcon.textContent = savedTheme === 'dark' ? 'light_mode' : 'dark_mode';

        if (themeToggle) {
          themeToggle.onclick = () => {
            const isDark = html.getAttribute('data-theme') === 'dark';
            const newTheme = isDark ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            themeIcon.textContent = isDark ? 'dark_mode' : 'light_mode';
            localStorage.setItem('theme', newTheme);
            document.cookie = `theme=${newTheme}; path=/; max-age=31536000`;
          };
        }

        const header = document.getElementById('combined-header');
        let lastScroll = 0;
        if (header) {
          window.addEventListener('scroll', () => {
            const current = window.scrollY;
            if (current > 100 && current > lastScroll) {
              header.classList.add('hidden');
            } else if (current < lastScroll && current > 50) {
              header.classList.remove('hidden');
            }
            lastScroll = current;
          });
        }

        const menuBtn = document.getElementById('menu-btn');
        if (menuBtn) {
          menuBtn.onclick = () => {
            Toast.info("–ú–µ–Ω—é –Ω–∞–∂–∞—Ç–æ");
          };
        }

        window.Toast = {
          show: (msg) => {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = msg;
            toast.className = 'show';
            setTimeout(() => toast.className = '', 3000);
          },
          info: (msg) => Toast.show(msg),
          success: (msg) => Toast.show(msg),
          warning: (msg) => Toast.show(msg),
          error: (msg) => Toast.show(msg)
        };

        if (window.Telegram?.WebApp) {
          window.Telegram.WebApp.ready();
          window.Telegram.WebApp.expand();
        }
      });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>