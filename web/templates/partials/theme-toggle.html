<div class="theme-toggle-container" style="
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  font-size: 14px;
  width: fit-content;
  margin: 10px 0;
">
  <span style="color: var(--text-secondary);">üé® –¢–µ–º–∞:</span>
  
  <!-- –°–≤–∏—Ç—á–µ—Ä -->
  <label class="switch" style="
    position: relative;
    display: inline-block;
    width: 52px;
    height: 26px;
  ">
    <input type="checkbox" id="theme-switch" onchange="toggleTheme()">
    <span class="slider" style="
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #b0b0b0;
      transition: 0.4s;
      border-radius: 34px;
    ">
      <span class="slider-thumb" style="
        position: absolute;
        content: '';
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 3px;
        background: white;
        transition: 0.4s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      "></span>
    </span>
  </label>

  <span id="theme-label" style="min-width: 60px; color: var(--text);">
    {{ '–°–≤–µ—Ç–ª–∞—è' if theme == 'dark' else '–¢—ë–º–Ω–∞—è' }}
  </span>
</div>

<!-- –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
<script>
  const switchEl = document.getElementById('theme-switch');
  const labelEl = document.getElementById('theme-label');
  const html = document.documentElement;

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
  const savedTheme = localStorage.getItem('theme') || '{{ theme }}';
  if (savedTheme) {
    html.setAttribute('data-theme', savedTheme);
    switchEl.checked = savedTheme === 'dark';
    updateLabel(savedTheme);
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
  async function toggleTheme() {
    const isDark = html.getAttribute('data-theme') === 'dark';
    const newTheme = isDark ? 'light' : 'dark';

    // –ú–µ–Ω—è–µ–º –∞—Ç—Ä–∏–±—É—Ç
    html.setAttribute('data-theme', newTheme);

    // –û–±–Ω–æ–≤–ª—è–µ–º UI
    switchEl.checked = !isDark;
    updateLabel(newTheme);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º
    localStorage.setItem('theme', newTheme);

    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
    try {
      await fetch('/api/user/theme', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ theme: newTheme })
      });
    } catch (e) {
      console.log('–¢–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ');
    }
  }

  function updateLabel(theme) {
    labelEl.textContent = theme === 'dark' ? '–¢—ë–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è';
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–º—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å gradient-bg)
  html.style.transition = 'background 0.5s ease';
</script>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–∏—Ç—á–µ—Ä–∞ -->
<style>
  .switch input { display: none; }

  .switch .slider:hover {
    background: #9e9e9e;
  }

  .switch input:checked + .slider {
    background: #4CAF50;
  }

  .switch input:checked + .slider .slider-thumb {
    background: white;
    transform: translateX(26px);
  }

  .switch input:focus + .slider {
    box-shadow: 0 0 1px #4CAF50;
  }
</style>